/**
 * Mobile Layout CSS - Isolamento completo da desktop
 * 
 * Namespace: .mobileRoot
 * Prefisso: .m* (mApp, mHeader, mMain, mScroller, mComposer, mSidebar, mOverlay, mViewer, mModal)
 * 
 * Regole:
 * - State machine con classi .state-chat, .state-sidebar, .state-viewer, .state-modal
 * - Tap isolation con pointer-events
 * - Scroll policy: un solo scroll container attivo per stato
 */

/* ============================================
   Z-INDEX SCALE
   ============================================ */
:root {
    --z-header: 10;
    --z-composer: 10;
    --z-fab: 20;
    --z-overlay: 30;
    --z-sidebar: 40;
    --z-viewer: 50;
    --z-modal: 60;
}

/* ============================================
   MOBILE APP CONTAINER (.mApp)
   ============================================ */
.mobileRoot .mApp {
    height: 100dvh !important;
    max-height: 100dvh !important;
    width: 100vw !important;
    max-width: 100vw !important;
    display: grid !important;
    grid-template-rows: auto 1fr auto !important; /* Header, Main, Composer */
    overflow: hidden !important;
    position: relative !important;
    background-color: var(--color-off-white) !important;
    box-sizing: border-box !important;
}

/* ============================================
   HEADER MOBILE (.mHeader) - Sticky
   ============================================ */
.mobileRoot .mHeader {
    position: sticky !important;
    top: 0 !important;
    z-index: var(--z-header) !important;
    display: flex !important;
    align-items: center !important;
    gap: clamp(8px, 2vw, 12px) !important;
    padding: clamp(8px, 2vw, 12px) clamp(12px, 3vw, 16px) !important;
    background-color: var(--color-white) !important;
    border-bottom: 1px solid var(--color-border) !important;
    flex-shrink: 0 !important;
    isolation: isolate !important;
    pointer-events: auto !important;
    box-sizing: border-box !important;
    max-width: 100vw !important;
    overflow: hidden !important;
}

/* Logo e titolo NON devono intercettare tap */
.mobileRoot .mHeader .logo-container,
.mobileRoot .mHeader .chat-title {
    pointer-events: none;
    user-select: none;
    -webkit-user-select: none;
    cursor: default;
}

/* Sidebar toggle button */
.mobileRoot .mHeader .sidebar-toggle-btn {
    pointer-events: auto;
    min-width: 44px;
    min-height: 44px;
    z-index: 1001;
}

/* Header actions container */
.mobileRoot .mHeader .header-actions {
    display: flex !important;
    align-items: center !important;
    gap: 8px !important;
    margin-left: auto !important;
    pointer-events: auto !important;
}

/* Add Wine Button - Tondo granaccia con + bianco */
.mobileRoot .mHeader .btn-add-wine-mobile {
    width: 44px !important;
    height: 44px !important;
    border-radius: 50% !important;
    background-color: var(--color-granaccia) !important;
    color: var(--color-white) !important;
    border: none !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    cursor: pointer !important;
    transition: all 0.2s ease !important;
    padding: 0 !important;
    flex-shrink: 0 !important;
    box-shadow: 0 2px 4px rgba(154, 24, 46, 0.2) !important;
}

.mobileRoot .mHeader .btn-add-wine-mobile:hover,
.mobileRoot .mHeader .btn-add-wine-mobile:active {
    background-color: rgba(154, 24, 46, 0.9) !important;
    transform: scale(1.05) !important;
    box-shadow: 0 3px 6px rgba(154, 24, 46, 0.3) !important;
}

.mobileRoot .mHeader .btn-add-wine-mobile:active {
    transform: scale(0.95) !important;
}

.mobileRoot .mHeader .btn-add-wine-mobile svg {
    width: 20px !important;
    height: 20px !important;
    stroke: var(--color-white) !important;
    stroke-width: 2 !important;
}

/* Inventory Button - Ovale tipo salsicciotto */
.mobileRoot .mHeader .btn-inventory-mobile {
    height: 36px !important;
    padding: 0 16px !important;
    border-radius: 18px !important; /* Ovale */
    background-color: var(--color-white) !important;
    color: var(--color-granaccia) !important;
    border: 2px solid var(--color-granaccia) !important;
    font-size: 14px !important;
    font-weight: 600 !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    cursor: pointer !important;
    transition: all 0.2s ease !important;
    white-space: nowrap !important;
    flex-shrink: 0 !important;
    box-shadow: 0 2px 4px rgba(154, 24, 46, 0.1) !important;
}

.mobileRoot .mHeader .btn-inventory-mobile:hover,
.mobileRoot .mHeader .btn-inventory-mobile:active {
    background-color: var(--color-granaccia) !important;
    color: var(--color-white) !important;
    transform: scale(1.02) !important;
    box-shadow: 0 3px 6px rgba(154, 24, 46, 0.3) !important;
}

.mobileRoot .mHeader .btn-inventory-mobile:active {
    transform: scale(0.98) !important;
}

/* Theme Toggle Mobile */
.mobileRoot .mHeader .ui-themeToggle-mobile {
    display: inline-flex !important;
    align-items: center !important;
    margin-right: 8px !important;
    flex-shrink: 0 !important;
}

.mobileRoot .mHeader .ui-themeToggle-mobile .ui-themeToggle__input {
    position: absolute !important;
    width: 1px !important;
    height: 1px !important;
    margin: -1px !important;
    padding: 0 !important;
    border: 0 !important;
    overflow: hidden !important;
    clip: rect(0 0 0 0) !important;
    clip-path: inset(50%) !important;
    white-space: nowrap !important;
}

.mobileRoot .mHeader .ui-themeToggle-mobile .ui-themeToggle__track {
    width: 46px !important;
    height: 26px !important;
    border-radius: 999px !important;
    cursor: pointer !important;
    display: inline-flex !important;
    align-items: center !important;
    position: relative !important;
    box-sizing: border-box !important;
    background: var(--border) !important;
    border: 1px solid var(--border) !important;
    transition: background .2s ease, border-color .2s ease !important;
}

.mobileRoot .mHeader .ui-themeToggle-mobile .ui-themeToggle__thumb {
    width: 20px !important;
    height: 20px !important;
    border-radius: 50% !important;
    display: block !important;
    position: absolute !important;
    left: 3px !important;
    top: 50% !important;
    transform: translateY(-50%) !important;
    box-sizing: border-box !important;
    background: var(--bg) !important;
    border: 1px solid var(--border) !important;
    transition: left .3s cubic-bezier(0.4, 0, 0.2, 1), 
                border-color .3s cubic-bezier(0.4, 0, 0.2, 1),
                transform .3s cubic-bezier(0.4, 0, 0.2, 1),
                box-shadow .3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
}

.mobileRoot .mHeader .ui-themeToggle-mobile .ui-themeToggle__input:checked + .ui-themeToggle__track {
    background: color-mix(in srgb, var(--accent) 30%, var(--panel) 70%) !important;
    border-color: color-mix(in srgb, var(--accent) 45%, var(--border) 55%) !important;
}

.mobileRoot .mHeader .ui-themeToggle-mobile .ui-themeToggle__input:checked + .ui-themeToggle__track .ui-themeToggle__thumb {
    left: 23px !important;
    border-color: color-mix(in srgb, var(--accent) 45%, var(--border) 55%) !important;
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15) !important;
    transform: translateY(-50%) scale(1.05) !important;
}

/* Logout Button Mobile */
.mobileRoot .mHeader .btn-logout-mobile {
    width: 36px !important;
    height: 36px !important;
    padding: 0 !important;
    border-radius: 8px !important;
    background-color: transparent !important;
    color: var(--color-text-primary) !important;
    border: 1px solid var(--color-border) !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    cursor: pointer !important;
    transition: all 0.2s ease !important;
    flex-shrink: 0 !important;
    margin-left: 8px !important;
}

.mobileRoot .mHeader .btn-logout-mobile:hover,
.mobileRoot .mHeader .btn-logout-mobile:active {
    background-color: var(--color-light-gray) !important;
    border-color: var(--color-granaccia) !important;
    color: var(--color-granaccia) !important;
}

.mobileRoot .mHeader .btn-logout-mobile svg {
    width: 18px !important;
    height: 18px !important;
    stroke: currentColor !important;
}

/* ============================================
   MAIN CONTENT MOBILE (.mMain)
   ============================================ */
.mobileRoot .mMain {
    flex: 1 !important;
    overflow: hidden !important;
    display: flex !important;
    flex-direction: column !important;
    min-height: 0 !important;
}

/* ============================================
   SCROLLER MOBILE (.mScroller) - SCROLL ROOT
   ============================================ */
.mobileRoot .mScroller,
.mobileRoot #chatScroll {
    flex: 1 !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
    -webkit-overflow-scrolling: touch !important;
    min-height: 0 !important;
    padding: clamp(12px, 3vw, 16px) !important;
    box-sizing: border-box !important;
    max-width: 100vw !important;
}

.mobileRoot .mScroller .welcome-message {
    text-align: center;
    padding: 48px 24px;
    color: var(--color-text-secondary);
}

.mobileRoot .mScroller .welcome-message h2 {
    font-size: 24px;
    font-weight: 600;
    color: var(--color-black);
    margin-bottom: 8px;
}

/* ============================================
   COMPOSER MOBILE (.mComposer) - Sticky
   ============================================ */
.mobileRoot .mComposer {
    position: sticky !important;
    bottom: 0 !important;
    z-index: var(--z-composer) !important;
    background-color: var(--color-white) !important;
    border-top: 1px solid var(--color-border) !important;
    padding: clamp(10px, 2.5vw, 12px) clamp(12px, 3vw, 16px) !important;
    flex-shrink: 0 !important;
    box-sizing: border-box !important;
    max-width: 100vw !important;
}

.mobileRoot .mComposer .chat-form {
    display: flex;
    gap: clamp(8px, 2vw, 12px);
    align-items: flex-end;
    max-width: 100%;
    box-sizing: border-box;
}

.mobileRoot .mComposer .chat-input {
    flex: 1;
    min-width: 0; /* Permette al contenuto di restringersi */
    padding: clamp(10px, 2.5vw, 12px) clamp(12px, 3vw, 16px);
    border: 1px solid var(--color-border);
    border-radius: 24px;
    font-size: clamp(14px, 3.5vw, 16px); /* Previene zoom su iOS, ma permette ridimensionamento */
    resize: none;
    max-height: clamp(80px, 25vw, 120px);
    box-sizing: border-box;
}

.mobileRoot .mComposer .chat-send-btn {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background-color: var(--color-granaccia);
    color: var(--color-white);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

/* ============================================
   OVERLAY MOBILE (.mOverlay) - Solo quando aperto
   ============================================ */
.mobileRoot .mOverlay {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 100dvh !important;
    background-color: rgba(0, 0, 0, 0.5) !important;
    z-index: var(--z-overlay) !important;
    display: none !important;
    pointer-events: none !important;
}

.mobileRoot .mOverlay.is-open {
    display: block !important;
    pointer-events: auto !important;
}

/* Overlay NON deve coprire il viewer quando è aperto */
.mobileRoot .mApp.state-viewer .mOverlay {
    pointer-events: none !important;
    z-index: 0 !important; /* Sotto il viewer */
    display: none !important; /* Nascondi completamente quando viewer è aperto */
}

/* Modal NON deve coprire il viewer quando è aperto */
.mobileRoot .mApp.state-viewer .mModal {
    pointer-events: none !important;
    z-index: 0 !important; /* Sotto il viewer */
    display: none !important; /* Nascondi completamente quando viewer è aperto */
}

/* ============================================
   SIDEBAR MOBILE (.mSidebar) - Drawer
   ============================================ */
.mobileRoot .mSidebar {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: min(280px, 85vw) !important;
    max-width: 280px !important;
    height: 100dvh !important;
    background-color: var(--color-white) !important;
    z-index: var(--z-sidebar) !important;
    transform: translateX(-100%) !important;
    transition: transform 0.3s ease !important;
    pointer-events: none !important;
    display: flex !important;
    flex-direction: column !important;
    box-sizing: border-box !important;
}

.mobileRoot .mSidebar.is-open {
    transform: translateX(0) !important;
    pointer-events: auto !important;
}

.mobileRoot .mSidebar .chat-sidebar-header {
    display: flex !important;
    justify-content: space-between !important;
    align-items: center !important;
    gap: 8px !important;
}

.mobileRoot .mSidebar .sidebar-close-btn {
    background: transparent !important;
    border: none !important;
    padding: 8px !important;
    cursor: pointer !important;
    color: var(--color-text-primary) !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    min-width: 44px !important;
    min-height: 44px !important;
    border-radius: 4px !important;
    transition: background-color 0.2s !important;
}

.mobileRoot .mSidebar .sidebar-close-btn:hover,
.mobileRoot .mSidebar .sidebar-close-btn:active {
    background-color: var(--color-border) !important;
}

.mobileRoot .mSidebar .sidebar-close-btn svg {
    width: 20px !important;
    height: 20px !important;
}

.mobileRoot .mSidebar .chat-sidebar-list {
    flex: 1;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    padding: 8px;
    min-height: 0 !important; /* Permette alla lista di restringersi quando il footer è presente */
}

.mobileRoot .mSidebar .chat-sidebar-footer {
    flex-shrink: 0 !important;
    padding: clamp(12px, 3vw, 16px) !important;
    border-top: 1px solid var(--color-border) !important;
    background-color: var(--color-white) !important;
    display: flex !important;
    flex-direction: column !important;
    gap: clamp(10px, 2.5vw, 12px) !important;
    box-sizing: border-box !important;
}

.mobileRoot .mSidebar .btn-place-order,
.mobileRoot .mSidebar .btn-settings {
    width: 100% !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    gap: clamp(6px, 1.5vw, 8px) !important;
    padding: clamp(10px, 2.5vw, 12px) clamp(12px, 3vw, 16px) !important;
    font-size: clamp(14px, 3.5vw, 16px) !important;
}

.mobileRoot .mSidebar .btn-place-order svg,
.mobileRoot .mSidebar .btn-settings svg {
    width: clamp(16px, 4vw, 18px) !important;
    height: clamp(16px, 4vw, 18px) !important;
}

.mobileRoot .mSidebar .chat-sidebar-footer-actions {
    display: flex !important;
    align-items: center !important;
    justify-content: space-between !important;
    gap: clamp(10px, 2.5vw, 12px) !important;
}

.mobileRoot .mSidebar .chat-sidebar-footer-actions .ui-themeToggle {
    flex-shrink: 0 !important;
}

.mobileRoot .mSidebar .chat-sidebar-footer-actions .btn {
    flex: 1 !important;
    padding: clamp(10px, 2.5vw, 12px) clamp(12px, 3vw, 16px) !important;
    font-size: clamp(14px, 3.5vw, 16px) !important;
}

.mobileRoot .mSidebar .chat-sidebar-item {
    padding: 12px 16px;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.2s;
    margin-bottom: 4px;
}

.mobileRoot .mSidebar .chat-sidebar-item:hover {
    background-color: var(--color-light-gray);
}

.mobileRoot .mSidebar .chat-sidebar-item.active {
    background-color: var(--color-granaccia);
    color: var(--color-white);
}

/* ============================================
  INVENTORY VIEWER MOBILE (.mViewer) - 3 Screens Design
  ============================================ */
.mobileRoot .mViewer {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 100dvh !important;
    background-color: var(--color-white) !important;
    z-index: var(--z-viewer) !important;
    display: none !important;
    flex-direction: column !important;
    pointer-events: none !important;
    overflow: hidden !important;
}

.mobileRoot .mViewer:not([hidden]) {
    display: flex !important;
    pointer-events: auto !important;
}

/* Assicura che quando viewerPanel non è hidden, pointer-events sia auto */
#viewerPanel:not([hidden]) {
    pointer-events: auto !important;
}

/* Assicura che il bottone abbia sempre pointer-events quando visibile */
.mobileRoot .mViewer:not([hidden]) .inventory-back-btn-mobile {
    pointer-events: auto !important;
}

/* FIX iOS Safari: header deve avere pointer-events auto quando viewer è aperto */
.mobileRoot .mApp.state-viewer .inventory-header-mobile {
    pointer-events: auto !important;
    -webkit-touch-callout: none !important;
}

/* FIX iOS Safari: previeni problemi di stacking context */
.mobileRoot .mApp.state-viewer .mViewer .inventory-header-mobile {
    position: relative !important;
    z-index: 10000 !important; /* Più alto del bottone per garantire che l'header sia sopra */
    transform: translateZ(0) !important; /* Crea nuovo stacking context su iOS */
    -webkit-transform: translateZ(0) !important;
}

/* Header comune inventario */
.mobileRoot .mViewer .inventory-header-mobile {
    flex-shrink: 0;
    padding: clamp(12px, 3vw, 16px);
    border-bottom: 1px solid var(--color-border);
    display: flex !important;
    justify-content: space-between;
    align-items: center;
    background-color: var(--color-white);
    z-index: 1000; /* Aumentato da 10 per garantire che l'header sia sopra altri elementi */
    box-sizing: border-box;
    max-width: 100vw;
    overflow: visible !important; /* Cambiato da hidden a visible per permettere al bottone di essere visibile */
    position: relative; /* Crea stacking context per z-index */
}

.mobileRoot .mViewer .inventory-header-left {
    display: flex;
    align-items: center;
    gap: clamp(8px, 2vw, 12px);
    flex: 1;
    min-width: 0; /* Permette al contenuto di restringersi se necessario */
    overflow: hidden;
}

.mobileRoot .mViewer .inventory-header-logo-mobile {
    height: clamp(24px, 6vw, 32px);
    width: auto;
    max-width: 100%;
    object-fit: contain;
    flex-shrink: 0;
}

.mobileRoot .mViewer .inventory-title-mobile {
    font-size: clamp(16px, 4vw, 24px);
    font-weight: 700;
    color: var(--color-granaccia);
    margin: 0;
    text-transform: uppercase;
    letter-spacing: clamp(0.5px, 0.2vw, 1px);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex-shrink: 1;
    min-width: 0;
}

/* Bottone indietro inventario mobile - Stile tondo */
/* IMPORTANTE: Usa selector più specifico per garantire che funzioni anche quando mViewer è visibile */
#inventory-back-btn-mobile,
.mobileRoot .mViewer .inventory-back-btn-mobile,
.mobileRoot .mViewer:not([hidden]) .inventory-back-btn-mobile,
.mobileRoot .mApp.state-viewer .mViewer .inventory-back-btn-mobile,
.mobileRoot .mViewer #inventory-back-btn-mobile {
    width: 50px !important;
    height: 50px !important;
    min-width: 50px !important;
    min-height: 50px !important;
    padding: 0 !important;
    margin: 0 !important;
    background-color: #8B1538 !important; /* Colore esplicito per test */
    color: white !important;
    border: 2px solid #8B1538 !important;
    border-radius: 50% !important; /* Bottone completamente tondo */
    font-size: 24px !important;
    font-weight: 600 !important;
    cursor: pointer !important;
    transition: all 0.2s ease !important;
    flex-shrink: 0 !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    pointer-events: auto !important;
    position: relative !important;
    z-index: 9999 !important;
    box-shadow: 0 4px 12px rgba(139, 21, 56, 0.4) !important;
    user-select: none !important;
    -webkit-user-select: none !important;
    -webkit-tap-highlight-color: rgba(139, 21, 56, 0.3) !important; /* Highlight visibile su iOS */
    touch-action: manipulation !important; /* Previene double-tap zoom e migliora responsiveness */
    -webkit-touch-callout: none !important; /* Disabilita menu contestuale iOS */
    visibility: visible !important;
    opacity: 1 !important;
    line-height: 1 !important;
}

.mobileRoot .mViewer .inventory-back-btn-mobile:active {
    transform: scale(0.95);
    opacity: 0.9;
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.2);
}

.mobileRoot .mViewer .inventory-back-btn-mobile:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

/* Container schermate */
.mobileRoot .mViewer .inventory-screen {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.mobileRoot .mViewer .inventory-screen.hidden {
    display: none !important;
}

/* ============================================
   SCHERMATA 1: LISTA INVENTARIO
   ============================================ */
.mobileRoot .mViewer .inventory-screen-list {
    padding: 0 clamp(12px, 3vw, 16px);
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    box-sizing: border-box;
    max-width: 100vw;
}

/* Search Bar */
.mobileRoot .mViewer .inventory-search-bar-mobile {
    position: relative;
    margin: clamp(12px, 3vw, 16px) 0;
    flex-shrink: 0;
    max-width: 100%;
    box-sizing: border-box;
}

.mobileRoot .mViewer .inventory-search-icon {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--color-text-secondary);
    pointer-events: none;
}

.mobileRoot .mViewer .inventory-search-input-mobile {
    width: 100%;
    max-width: 100%;
    padding: clamp(10px, 2.5vw, 12px) clamp(10px, 2.5vw, 12px) clamp(10px, 2.5vw, 12px) clamp(36px, 8vw, 40px);
    border: 1px solid var(--color-border);
    border-radius: 8px;
    font-size: clamp(14px, 3.5vw, 16px);
    background-color: var(--color-white);
    color: var(--color-text-primary);
    box-sizing: border-box;
}

.mobileRoot .mViewer .inventory-search-input-mobile:focus {
    outline: none;
    border-color: var(--color-granaccia);
}

/* Filters Dropdown */
.mobileRoot .mViewer .inventory-filters-dropdown-mobile {
    margin-bottom: clamp(12px, 3vw, 16px);
    flex-shrink: 0;
    position: relative;
    max-width: 100%;
    box-sizing: border-box;
}

.mobileRoot .mViewer .inventory-filters-dropdown-btn {
    width: 100%;
    max-width: 100%;
    padding: clamp(10px, 2.5vw, 12px) clamp(12px, 3vw, 16px);
    background-color: var(--color-white);
    border: 2px solid var(--color-granaccia);
    border-radius: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: clamp(12px, 3vw, 14px);
    font-weight: 600;
    box-sizing: border-box;
    color: var(--color-granaccia);
    cursor: pointer;
    transition: background-color 0.2s;
}

.mobileRoot .mViewer .inventory-filters-dropdown-btn:active {
    background-color: rgba(154, 24, 46, 0.05);
}

.mobileRoot .mViewer .inventory-filters-dropdown-menu {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    margin-top: clamp(6px, 1.5vw, 8px);
    background-color: var(--color-white);
    border: 1px solid var(--color-border);
    border-radius: 8px;
    padding: clamp(12px, 3vw, 16px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    z-index: 20;
    max-width: 100%;
    box-sizing: border-box;
    overflow-x: hidden;
}

.mobileRoot .mViewer .inventory-filters-dropdown-menu.hidden {
    display: none;
}

.mobileRoot .mViewer .inventory-filter-item-mobile {
    margin-bottom: clamp(12px, 3vw, 16px);
    max-width: 100%;
}

.mobileRoot .mViewer .inventory-filter-item-mobile:last-child {
    margin-bottom: 0;
}

.mobileRoot .mViewer .inventory-filter-label {
    display: block;
    font-size: 12px;
    font-weight: 600;
    color: var(--color-text-secondary);
    margin-bottom: 6px;
    text-transform: uppercase;
}

.mobileRoot .mViewer .inventory-filter-select {
    width: 100%;
    max-width: 100%;
    padding: clamp(8px, 2vw, 10px) clamp(10px, 2.5vw, 12px);
    border: 1px solid var(--color-border);
    border-radius: 6px;
    font-size: clamp(12px, 3vw, 14px);
    background-color: var(--color-white);
    color: var(--color-text-primary);
    box-sizing: border-box;
}

.mobileRoot .mViewer .inventory-filter-reset-btn {
    width: 100%;
    padding: 10px;
    margin-top: 12px;
    background-color: var(--color-light-gray);
    border: 1px solid var(--color-border);
    border-radius: 6px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.2s;
}

.mobileRoot .mViewer .inventory-filter-reset-btn:active {
    background-color: var(--color-border);
}

/* Wine List (Scrollable) */
.mobileRoot .mViewer .inventory-wine-list-mobile {
    flex: 1;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    margin-bottom: 16px;
}

.mobileRoot .mViewer .inventory-wine-item-btn {
    width: 100%;
    max-width: 100%;
    padding: clamp(12px, 3vw, 16px);
    margin-bottom: clamp(10px, 2.5vw, 12px);
    background-color: var(--color-granaccia);
    color: var(--color-white);
    border: none;
    border-radius: 8px;
    font-size: clamp(14px, 3.5vw, 16px);
    font-weight: 600;
    text-align: left;
    box-sizing: border-box;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    cursor: pointer;
    transition: opacity 0.2s, transform 0.1s;
}

.mobileRoot .mViewer .inventory-wine-item-btn:active {
    opacity: 0.8;
    transform: scale(0.98);
}

.mobileRoot .mViewer .inventory-loading {
    padding: 40px 20px;
    text-align: center;
    color: var(--color-text-secondary);
    font-size: 14px;
}

/* ============================================
   SCHERMATA 2: DETTAGLI VINO
   ============================================ */
.mobileRoot .mViewer .inventory-screen-details {
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
}

/* Wine Banner */
.mobileRoot .mViewer .inventory-wine-banner-mobile {
    width: 100%;
    max-width: 100vw;
    padding: clamp(12px, 3vw, 16px);
    background-color: var(--color-granaccia);
    color: var(--color-white);
    font-size: clamp(14px, 3.5vw, 18px);
    font-weight: 600;
    text-align: center;
    flex-shrink: 0;
    box-sizing: border-box;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

/* Content Layout */
.mobileRoot .mViewer .inventory-details-content-mobile {
    display: flex;
    flex-direction: column;
    gap: clamp(12px, 3vw, 16px);
    padding: clamp(12px, 3vw, 16px);
    box-sizing: border-box;
    max-width: 100vw;
}

/* Left Column */
.mobileRoot .mViewer .inventory-details-left-mobile {
    display: flex;
    flex-direction: column;
    gap: clamp(12px, 3vw, 16px);
    max-width: 100%;
    box-sizing: border-box;
}

/* Quantity Section */
.mobileRoot .mViewer .inventory-quantity-section-mobile {
    padding: clamp(12px, 3vw, 16px);
    background-color: var(--color-light-gray);
    border-radius: 8px;
    box-sizing: border-box;
    max-width: 100%;
}

.mobileRoot .mViewer .inventory-quantity-label {
    font-size: clamp(10px, 2.5vw, 12px);
    font-weight: 600;
    color: var(--color-text-secondary);
    text-transform: uppercase;
    margin-bottom: clamp(6px, 1.5vw, 8px);
}

.mobileRoot .mViewer .inventory-quantity-value {
    font-size: clamp(24px, 6vw, 32px);
    font-weight: 700;
    color: var(--color-text-primary);
}

/* Graph Preview (Clickable) */
.mobileRoot .mViewer .inventory-graph-preview-mobile {
    width: 100%;
    max-width: 100%;
    height: clamp(150px, 40vw, 200px);
    background-color: var(--color-light-gray);
    border-radius: 8px;
    padding: clamp(10px, 2.5vw, 12px);
    cursor: pointer;
    transition: background-color 0.2s;
    box-sizing: border-box;
}

.mobileRoot .mViewer .inventory-graph-preview-mobile:active {
    background-color: var(--color-border);
}

.mobileRoot .mViewer .inventory-graph-preview-canvas-mobile {
    width: 100%;
    height: 100%;
}

/* Save Button */
/* Bottone salva modifiche - Fix pointer-events e visibilità */
/* Selettori multipli per massima specificità (come bottone indietro) */
#inventory-save-btn-mobile,
.mobileRoot .mViewer .inventory-save-btn-mobile,
.mobileRoot .mViewer:not([hidden]) .inventory-save-btn-mobile,
.mobileRoot .mApp.state-viewer .mViewer .inventory-save-btn-mobile,
.mobileRoot .mViewer #inventory-save-btn-mobile {
    width: 100% !important;
    max-width: 100% !important;
    padding: clamp(12px, 3vw, 16px) !important;
    background-color: var(--color-granaccia) !important;
    color: var(--color-white) !important;
    border: none !important;
    border-radius: 8px !important;
    font-size: clamp(14px, 3.5vw, 16px) !important;
    font-weight: 600 !important;
    text-transform: uppercase !important;
    cursor: pointer !important;
    transition: opacity 0.2s !important;
    box-sizing: border-box !important;
    pointer-events: auto !important;
    position: relative !important;
    z-index: 9999 !important;
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    user-select: none !important;
    -webkit-user-select: none !important;
    -webkit-tap-highlight-color: rgba(139, 21, 56, 0.3) !important;
    touch-action: manipulation !important;
    -webkit-touch-callout: none !important;
}

.mobileRoot .mViewer .inventory-save-btn-mobile:active {
    opacity: 0.8;
}

/* Wine Form */
.mobileRoot .mViewer .inventory-wine-form-mobile {
    display: flex;
    flex-direction: column;
    gap: clamp(12px, 3vw, 16px);
    max-width: 100%;
    box-sizing: border-box;
}

.mobileRoot .mViewer .inventory-form-field-mobile {
    display: flex;
    flex-direction: column;
    gap: clamp(4px, 1vw, 6px);
    max-width: 100%;
}

.mobileRoot .mViewer .inventory-form-label-mobile {
    font-size: clamp(10px, 2.5vw, 12px);
    font-weight: 600;
    color: var(--color-text-secondary);
    text-transform: uppercase;
}

.mobileRoot .mViewer .inventory-form-input-mobile {
    width: 100%;
    max-width: 100%;
    padding: clamp(10px, 2.5vw, 12px);
    border: 1px solid var(--color-border);
    border-radius: 6px;
    font-size: clamp(14px, 3.5vw, 16px);
    background-color: var(--color-white);
    color: var(--color-text-primary);
    box-sizing: border-box;
}

.mobileRoot .mViewer .inventory-form-input-mobile:focus {
    outline: none;
    border-color: var(--color-granaccia);
}

/* Right Column: Movements Log */
.mobileRoot .mViewer .inventory-details-right-mobile {
    display: flex;
    flex-direction: column;
}

.mobileRoot .mViewer .inventory-movements-log-mobile {
    max-height: clamp(300px, 80vw, 400px);
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    display: flex;
    flex-direction: column;
    gap: clamp(10px, 2.5vw, 12px);
    padding: clamp(12px, 3vw, 16px);
    background-color: var(--color-light-gray);
    border-radius: 8px;
    box-sizing: border-box;
    max-width: 100%;
}

.mobileRoot .mViewer .inventory-movement-card-mobile {
    padding: 12px;
    border-radius: 8px;
    font-size: 14px;
    margin-bottom: 8px;
}

.mobileRoot .mViewer .inventory-movement-card-mobile:last-child {
    margin-bottom: 0;
}

.mobileRoot .mViewer .inventory-movement-card-mobile.consumed {
    background-color: var(--color-granaccia);
    color: var(--color-white);
}

.mobileRoot .mViewer .inventory-movement-card-mobile.refilled {
    background-color: var(--color-white);
    color: var(--color-text-primary);
    border: 1px solid var(--color-border);
}

.mobileRoot .mViewer .inventory-movement-header-mobile {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.mobileRoot .mViewer .inventory-movement-label-mobile {
    font-weight: 600;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.mobileRoot .mViewer .inventory-movement-quantity-mobile {
    font-size: 16px;
    font-weight: 700;
}

.mobileRoot .mViewer .inventory-movement-details-mobile {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.mobileRoot .mViewer .inventory-movement-stock-mobile {
    font-size: 13px;
    opacity: 0.9;
}

.mobileRoot .mViewer .inventory-movement-card-mobile.refilled .inventory-movement-stock-mobile {
    color: var(--color-text-secondary);
}

.mobileRoot .mViewer .inventory-movement-date-mobile {
    font-size: 12px;
    opacity: 0.8;
}

/* ============================================
   SCHERMATA 3: GRAFICO FULLSCREEN
   ============================================ */
.mobileRoot .mViewer .inventory-screen-chart {
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
}

/* Period Filters */
.mobileRoot .mViewer .inventory-period-filters-mobile {
    display: flex;
    gap: clamp(6px, 1.5vw, 8px);
    padding: clamp(12px, 3vw, 16px);
    flex-shrink: 0;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    box-sizing: border-box;
    max-width: 100vw;
}

.mobileRoot .mViewer .inventory-period-btn {
    padding: clamp(8px, 2vw, 10px) clamp(12px, 3vw, 16px);
    background-color: var(--color-light-gray);
    color: var(--color-text-primary);
    border: 1px solid var(--color-border);
    border-radius: 8px;
    font-size: clamp(12px, 3vw, 14px);
    font-weight: 600;
    cursor: pointer;
    white-space: nowrap;
    transition: all 0.2s;
    flex-shrink: 0;
}

.mobileRoot .mViewer .inventory-period-btn.active {
    background-color: var(--color-granaccia);
    color: var(--color-white);
    border-color: var(--color-granaccia);
}

.mobileRoot .mViewer .inventory-period-btn:active {
    opacity: 0.8;
}

/* Chart Container */
.mobileRoot .mViewer .inventory-chart-container-mobile {
    flex: 1;
    padding: clamp(12px, 3vw, 16px);
    min-height: clamp(300px, 75vw, 400px);
    display: flex;
    align-items: center;
    justify-content: center;
    box-sizing: border-box;
    max-width: 100vw;
    overflow: hidden;
}

.mobileRoot .mViewer .inventory-chart-canvas-mobile {
    width: 100%;
    max-width: 100%;
    height: auto;
    box-sizing: border-box;
}

.mobileRoot .mViewer .viewer-content {
    flex: 1;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    padding: 16px;
}

.mobileRoot .mViewer .viewer-header {
    padding: 16px;
    border-bottom: 1px solid var(--color-border);
    flex-shrink: 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.mobileRoot .mViewer .viewer-close-btn {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Viewer Actions Mobile (Download CSV) */
.mobileRoot .mViewer .viewer-actions-mobile {
    padding: 12px 0;
    border-bottom: 1px solid var(--color-border);
    margin-bottom: 12px;
}

.mobileRoot .mViewer .viewer-actions-mobile .btn {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

/* Viewer Filters Mobile */
.mobileRoot .mViewer .viewer-filters-mobile {
    margin-bottom: 12px;
}

.mobileRoot .mViewer .viewer-filters-toggle {
    width: 100%;
    padding: 12px 16px;
    background-color: var(--color-light-gray);
    border: 1px solid var(--color-border);
    border-radius: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    font-weight: 600;
    font-size: 14px;
    transition: background-color 0.2s;
}

.mobileRoot .mViewer .viewer-filters-toggle:hover {
    background-color: var(--color-border);
}

.mobileRoot .mViewer .viewer-filters-toggle svg {
    transition: transform 0.2s;
}

.mobileRoot .mViewer .viewer-filters-content {
    margin-top: 12px;
    padding: 16px;
    background-color: var(--color-white);
    border: 1px solid var(--color-border);
    border-radius: 8px;
}

.mobileRoot .mViewer .viewer-filters-content.hidden {
    display: none;
}

.mobileRoot .mViewer .filters-header-row-mobile {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}

.mobileRoot .mViewer .filters-title-mobile {
    font-size: 14px;
    font-weight: 700;
    margin: 0;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.mobileRoot .mViewer .reset-filters-btn-mobile {
    padding: 6px 12px;
    background-color: transparent;
    border: 1px solid var(--color-border);
    border-radius: 6px;
    font-size: 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: all 0.2s;
}

.mobileRoot .mViewer .reset-filters-btn-mobile:hover {
    background-color: var(--color-light-gray);
    border-color: var(--color-granaccia);
}

.mobileRoot .mViewer .filters-buttons-row-mobile {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.mobileRoot .mViewer .filter-dropdown-wrapper-mobile {
    position: relative;
}

.mobileRoot .mViewer .filter-dropdown-btn-mobile {
    width: 100%;
    padding: 12px 16px;
    background-color: var(--color-white);
    border: 1px solid var(--color-border);
    border-radius: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.2s;
}

.mobileRoot .mViewer .filter-dropdown-btn-mobile:hover,
.mobileRoot .mViewer .filter-dropdown-btn-mobile.active {
    border-color: var(--color-granaccia);
    background-color: rgba(154, 24, 46, 0.05);
}

.mobileRoot .mViewer .filter-btn-label-mobile {
    font-weight: 600;
    margin-right: 8px;
}

.mobileRoot .mViewer .filter-btn-value-mobile {
    flex: 1;
    text-align: right;
    color: var(--color-text-secondary);
}

.mobileRoot .mViewer .filter-dropdown-icon-mobile {
    margin-left: 8px;
    transition: transform 0.2s;
}

.mobileRoot .mViewer .filter-dropdown-menu-mobile {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    margin-top: 4px;
    background-color: var(--color-white);
    border: 1px solid var(--color-border);
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    max-height: 200px;
    overflow-y: auto;
    z-index: 10;
}

.mobileRoot .mViewer .filter-dropdown-menu-mobile.hidden {
    display: none;
}

.mobileRoot .mViewer .filter-dropdown-content-mobile {
    padding: 8px;
}

.mobileRoot .mViewer .filter-item-mobile {
    padding: 10px 12px;
    border-radius: 6px;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: background-color 0.2s;
    font-size: 14px;
}

.mobileRoot .mViewer .filter-item-mobile:hover {
    background-color: var(--color-light-gray);
}

.mobileRoot .mViewer .filter-item-mobile.active {
    background-color: rgba(154, 24, 46, 0.1);
    color: var(--color-granaccia);
    font-weight: 600;
}

.mobileRoot .mViewer .filter-count-mobile {
    font-size: 12px;
    color: var(--color-text-secondary);
    margin-left: 8px;
}

/* ============================================
   MODAL MOBILE (.mModal) - Top Layer
   ============================================ */
.mobileRoot .mModal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100dvh;
    background-color: rgba(0, 0, 0, 0.7);
    z-index: var(--z-modal);
    display: none;
    align-items: center;
    justify-content: center;
    pointer-events: none;
}

.mobileRoot .mModal:not([hidden]) {
    display: flex;
    pointer-events: auto;
}

.mobileRoot .mModal .modal-content {
    background-color: var(--color-white);
    border-radius: 12px;
    padding: 0;
    max-width: 90%;
    max-height: 90dvh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    -webkit-overflow-scrolling: touch;
}

.mobileRoot .mModal .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 20px;
    border-bottom: 1px solid var(--color-border);
    flex-shrink: 0;
}

.mobileRoot .mModal .modal-header h2 {
    font-size: 20px;
    font-weight: 600;
    color: var(--color-text-primary);
    margin: 0;
}

.mobileRoot .mModal .modal-close-btn {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: none;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--color-text-primary);
    transition: background-color 0.2s;
    padding: 0;
}

.mobileRoot .mModal .modal-close-btn:hover,
.mobileRoot .mModal .modal-close-btn:active {
    background-color: var(--color-light-gray);
}

.mobileRoot .mModal .modal-body {
    flex: 1;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    padding: 20px;
}

/* ============================================
   STATE MACHINE - TAP ISOLATION
   ============================================ */

/* STATE: CHAT (default) */
.mobileRoot .mApp.state-chat .mMain,
.mobileRoot .mApp.state-chat .mComposer {
    pointer-events: auto;
}

.mobileRoot .mApp.state-chat .mSidebar,
.mobileRoot .mApp.state-chat .mOverlay,
.mobileRoot .mApp.state-chat .mViewer,
.mobileRoot .mApp.state-chat .mModal {
    pointer-events: none !important;
}

.mobileRoot .mApp.state-chat #chatScroll {
    overflow-y: auto !important;
    overflow-x: hidden !important;
}

/* STATE: SIDEBAR_OPEN */
.mobileRoot .mApp.state-sidebar .mOverlay,
.mobileRoot .mApp.state-sidebar .mSidebar {
    pointer-events: auto !important;
}

.mobileRoot .mApp.state-sidebar .mMain,
.mobileRoot .mApp.state-sidebar .mComposer {
    pointer-events: none !important; /* NO tap-through */
}

.mobileRoot .mApp.state-sidebar #chatScroll {
    overflow: hidden !important; /* Disabilita scroll chat */
}

.mobileRoot .mApp.state-sidebar .chat-sidebar-list {
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
}

/* STATE: VIEWER_OPEN */
.mobileRoot .mApp.state-viewer .mViewer {
    pointer-events: auto !important;
    display: flex !important; /* Forza display quando nello stato viewer */
}

/* FORZA pointer-events su viewerPanel quando state-viewer è attivo (massima priorità) */
.mobileRoot .mApp.state-viewer #viewerPanel:not([hidden]) {
    pointer-events: auto !important;
}

.mobileRoot .mApp.state-viewer #viewerPanel:not([hidden]) .inventory-back-btn-mobile {
    pointer-events: auto !important;
}

.mobileRoot .mApp.state-viewer #viewerPanel:not([hidden]) .inventory-save-btn-mobile {
    pointer-events: auto !important;
}

.mobileRoot .mApp.state-viewer .mSidebar,
.mobileRoot .mApp.state-viewer .mMain,
.mobileRoot .mApp.state-viewer .mComposer {
    pointer-events: none !important; /* NO tap-through */
}

.mobileRoot .mApp.state-viewer #chatScroll {
    overflow: hidden !important; /* Disabilita scroll chat */
}

.mobileRoot .mApp.state-viewer .viewer-content {
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
}

/* STATE: MODAL_OPEN */
.mobileRoot .mApp.state-modal .mModal {
    pointer-events: auto !important;
}

.mobileRoot .mApp.state-modal .mSidebar,
.mobileRoot .mApp.state-modal .mViewer,
.mobileRoot .mApp.state-modal .mMain,
.mobileRoot .mApp.state-modal .mComposer {
    pointer-events: none !important; /* NO tap-through */
}

.mobileRoot .mApp.state-modal #chatScroll {
    overflow: hidden !important; /* Disabilita scroll chat */
}

.mobileRoot .mApp.state-modal .modal-content {
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
}

/* ============================================
   WINE CARDS MOBILE - Ridotte del 50% con bottoni integrati
   ============================================ */
.mobileRoot .wine-card {
    position: relative !important; /* Per posizionare bottoni assoluti dentro */
    padding: 8px !important; /* 16px -> 8px (50%) */
    margin: 0 8px !important; /* 16px -> 8px (50%) */
    min-height: 110px !important; /* 220px -> 110px (50%) */
    border-radius: 8px !important; /* Ridotto proporzionalmente */
}

.mobileRoot .wine-card-body {
    gap: 6px !important; /* 12px -> 6px (50%) */
    min-height: 50px !important; /* 100px -> 50px (50%) */
}

.mobileRoot .wine-card-header {
    padding-bottom: 6px !important; /* 12px -> 6px (50%) */
    margin-bottom: 6px !important; /* 12px -> 6px (50%) */
}

.mobileRoot .wine-card-title {
    font-size: 14px !important; /* 18px -> 14px (circa 50%) */
    line-height: 1.3 !important;
    margin-bottom: 4px !important;
}

.mobileRoot .wine-card-producer {
    font-size: 12px !important; /* Ridotto proporzionalmente */
}

.mobileRoot .wine-card-field {
    margin-bottom: 4px !important; /* Ridotto proporzionalmente */
}

.mobileRoot .wine-card-field-label {
    font-size: 10px !important; /* Ridotto proporzionalmente */
    margin-bottom: 2px !important;
}

.mobileRoot .wine-card-field-value {
    font-size: 11px !important; /* 14px -> 11px (circa 50%) */
    line-height: 1.4 !important;
}

.mobileRoot .wine-card-field-value.price,
.mobileRoot .wine-card-field-value.quantity {
    font-size: 13px !important; /* 16px -> 13px (circa 50%) */
    font-weight: 600 !important;
}

.mobileRoot .wine-card-wrapper {
    margin-bottom: 8px !important; /* Ridotto proporzionalmente */
}

/* Movement cards e altre card simili */
.mobileRoot .movement-card,
.mobileRoot .wines-list-card,
.mobileRoot .inventory-list-card,
.mobileRoot .stats-card {
    padding: 8px !important;
    margin: 0 8px 8px 8px !important;
    font-size: 0.875em !important; /* Ridotto del ~12% */
}

.mobileRoot .movement-card .movement-card-header,
.mobileRoot .wines-list-card .wines-list-card-header {
    padding-bottom: 6px !important;
    margin-bottom: 6px !important;
    font-size: 14px !important;
}

.mobileRoot .movement-card .movement-card-body,
.mobileRoot .wines-list-card .wines-list-card-body {
    gap: 6px !important;
    font-size: 11px !important;
}

/* ============================================
   WINE CARD BUTTONS MOBILE - Bottoni circolari grigi dentro la card
   ============================================ */
.mobileRoot .wine-card-buttons-mobile {
    position: absolute !important;
    right: 8px !important;
    top: 8px !important;
    display: flex !important;
    flex-direction: column !important;
    gap: 6px !important;
    z-index: 10 !important;
    pointer-events: auto !important;
}

.mobileRoot .wine-card-button-mobile {
    width: 40px !important;
    height: 40px !important;
    border-radius: 50% !important;
    background-color: var(--color-light-gray) !important;
    color: var(--color-granaccia) !important;
    border: 2px solid var(--color-granaccia) !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    cursor: pointer !important;
    transition: all 0.2s ease !important;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
    padding: 0 !important;
    flex-shrink: 0 !important;
}

.mobileRoot .wine-card-button-mobile:hover,
.mobileRoot .wine-card-button-mobile:active {
    background-color: var(--color-granaccia) !important;
    color: var(--color-white) !important;
    transform: scale(1.05) !important;
    box-shadow: 0 3px 6px rgba(154, 24, 46, 0.3) !important;
}

.mobileRoot .wine-card-button-mobile svg {
    width: 18px !important;
    height: 18px !important;
    stroke: var(--color-granaccia) !important;
    fill: none !important;
}

.mobileRoot .wine-card-button-mobile:hover svg,
.mobileRoot .wine-card-button-mobile:active svg {
    stroke: var(--color-white) !important;
}

.mobileRoot .wine-card-button-mobile:active {
    transform: scale(0.95) !important;
}

/* Nascondi bookmarks desktop su mobile */
.mobileRoot .wine-card-bookmarks {
    display: none !important;
}

/* ============================================
   ADD WINE FORM MOBILE
   ============================================ */
.mobileRoot .add-wine-form-mobile {
    padding: 0;
}

.mobileRoot .add-wine-form-grid {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.mobileRoot .add-wine-field {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.mobileRoot .add-wine-field.full-width {
    width: 100%;
}

.mobileRoot .add-wine-label {
    font-size: 14px;
    font-weight: 600;
    color: var(--color-text-primary);
}

.mobileRoot .add-wine-input,
.mobileRoot .add-wine-textarea {
    width: 100%;
    padding: 12px;
    border: 1px solid var(--color-border);
    border-radius: 8px;
    font-size: 16px; /* Previene zoom su iOS */
    font-family: inherit;
    background-color: var(--color-white);
    color: var(--color-text-primary);
}

.mobileRoot .add-wine-input:focus,
.mobileRoot .add-wine-textarea:focus {
    outline: none;
    border-color: var(--color-granaccia);
    box-shadow: 0 0 0 3px rgba(154, 24, 46, 0.1);
}

.mobileRoot .add-wine-textarea {
    min-height: 80px;
    resize: vertical;
}

.mobileRoot .add-wine-actions {
    display: flex;
    gap: 12px;
    margin-top: 24px;
    padding-top: 16px;
    border-top: 1px solid var(--color-border);
}

.mobileRoot .add-wine-btn {
    flex: 1;
    padding: 12px 24px;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    border: none;
}

.mobileRoot .add-wine-btn.cancel {
    background-color: var(--color-light-gray);
    color: var(--color-text-primary);
}

.mobileRoot .add-wine-btn.cancel:hover,
.mobileRoot .add-wine-btn.cancel:active {
    background-color: var(--color-border);
}

.mobileRoot .add-wine-btn.save {
    background-color: var(--color-granaccia);
    color: var(--color-white);
}

.mobileRoot .add-wine-btn.save:hover,
.mobileRoot .add-wine-btn.save:active {
    background-color: rgba(154, 24, 46, 0.9);
    transform: scale(1.02);
}

.mobileRoot .add-wine-btn.save:active {
    transform: scale(0.98);
}

.mobileRoot .add-wine-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

/* ============================================
   VIEWER MOBILE STYLES
   ============================================ */
.mobileRoot .viewer-content {
    display: flex !important;
    flex-direction: column !important;
    height: 100% !important;
    overflow: hidden !important;
    background-color: var(--color-white) !important;
}

.mobileRoot .viewer-header {
    display: flex !important;
    justify-content: space-between !important;
    align-items: center !important;
    padding: 16px !important;
    border-bottom: 1px solid var(--color-border) !important;
    flex-shrink: 0 !important;
    background-color: var(--color-white) !important;
}

.mobileRoot .viewer-header h2 {
    font-size: 20px !important;
    font-weight: 600 !important;
    color: var(--color-text-primary) !important;
    margin: 0 !important;
}

.mobileRoot .viewer-close-btn {
    width: 44px !important;
    height: 44px !important;
    border-radius: 50% !important;
    background: none !important;
    border: none !important;
    cursor: pointer !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    color: var(--color-text-primary) !important;
    transition: background-color 0.2s !important;
    padding: 0 !important;
}

.mobileRoot .viewer-close-btn:hover,
.mobileRoot .viewer-close-btn:active {
    background-color: var(--color-light-gray) !important;
}

.mobileRoot .viewer-body {
    flex: 1 !important;
    overflow: hidden !important;
    display: flex !important;
    flex-direction: column !important;
    background-color: var(--color-white) !important;
}

.mobileRoot #viewer-table-container {
    flex: 1;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
}

.mobileRoot #viewer-table {
    width: 100% !important;
    border-collapse: collapse !important;
    font-size: 14px !important;
    background-color: var(--color-white) !important;
}

.mobileRoot #viewer-table thead {
    position: sticky;
    top: 0;
    background-color: var(--color-white);
    z-index: 10;
}

.mobileRoot #viewer-table th {
    padding: 12px;
    text-align: left;
    font-weight: 600;
    color: var(--color-text-primary);
    border-bottom: 2px solid var(--color-border);
    background-color: var(--color-white);
}

.mobileRoot #viewer-table td {
    padding: 12px !important;
    border-bottom: 1px solid var(--color-border) !important;
    color: var(--color-text-secondary) !important;
    background-color: var(--color-white) !important;
}

.mobileRoot #viewer-table tbody tr:hover {
    background-color: var(--color-light-gray);
}

.mobileRoot #viewer-table .loading {
    text-align: center;
    padding: 24px;
    color: var(--color-text-secondary);
}

/* ============================================
   UTILITY CLASSES
   ============================================ */
.mobileRoot .hidden {
    display: none !important;
}

